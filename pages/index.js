import React, { useState, useEffect, useCallback } from 'react';
import Head from 'next/head'
import Image from 'next/image'
import dynamic from 'next/dynamic'
import styles from '../styles/Home.module.css'
import { shareKakao } from '../lib/kakao/shareKakao';
import translator from "../lib/Translator";

// import { Loading } from '../lib/loadingSpinner';
// import initialize from '../lib/kakao/initialize';
// import AnimationButton from './animation';

const isServer = () => typeof window === 'undefined';

const NoSSRComponent = dynamic(() => import("./slotMachine"), {
  loading: () => <p>.....</p>,
  ssr: false,
});

export default function Home() {
  var menuList = ["ê°ˆë¹„ì°œ", "êµ­ë°¥", "êµ­ìˆ˜", "ê¹€ë°¥", "ê¹€ì¹˜ë³¶ìŒë°¥", "ê¹€ì¹˜ì°œ", "ëƒ‰ë©´", "ë‹­ê°ˆë¹„",
                  "ë‹­ë³¶ìŒíƒ•", "ë„ì‹œë½", "ëˆê¹ŒìŠ¤", "ë–¡ë³¶ì´", "ë¼ë©˜", "ë¼ë©´", "ë¦¬ì†Œí† ", "ë³´ìŒˆ", "ë³¶ìŒë°¥",
                  "ë¶„ì‹", "ë¶ˆê³ ê¸°", "ë¹„ë¹”ë°¥", "ì‚¼ê³„íƒ•", "ìƒŒë“œìœ„ì¹˜", "ìƒì„ êµ¬ì´", "ìˆ˜ì œë¹„", "ìˆœëŒ€", "ìŠ¤í…Œì´í¬", "ìŒ€êµ­ìˆ˜", "ì•Œë°¥", "ì–‘ê¼¬ì¹˜", "ì—°ì–´ë®ë°¥", "ìš°ë™", "ì›”ë‚¨ìŒˆ", "ì œìœ¡ë³¶ìŒ",
                  "ì§¬ë½•", "ì­ˆê¾¸ë¯¸", "ì°Œê°œ", "ì°œë‹­", "ì´ˆë°¥", "ì¶”ì–´íƒ•", "ì¹˜í‚¨", "ì¹¼êµ­ìˆ˜", "íƒ€ì½”", "íƒ•ìˆ˜ìœ¡", "íŒŒìŠ¤íƒ€", "íŒŸíƒ€ì´", "í”¼ì", "í•œì •ì‹", "í•´ì¥êµ­", "í–„ë²„ê±°"
                ]  
  useEffect(() => {
    // useEffect() ëŠ” ì´ˆê¸° ë¹Œë“œì—ëŠ” ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ
    // ì²˜ìŒ ssrì‹œì—ëŠ” window ê°ì²´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šë„ë¡
    window.Kakao.init('96a24fa84b8245d9c5ef14fd911fba9a');
  }, []);

  // [state(ui ë°”ë€ŒëŠ”)ë³€ìˆ˜, í•´ë‹¹ ë³€ìˆ˜ë¥¼ ê°±ì‹ í•˜ëŠ” í•¨ìˆ˜]
  const [items, setItems] = useState('ğŸ‘†ëˆŒëŸ¬ì„œ í™•ì¸í•˜ê¸°');
  const [links, setLinks] = useState("https://map.naver.com/v5/search/");
  const [imgs, setImgs] = useState("/logo.png");
  const [loading, setLoading] = useState(false);

  const clickHandler = () => {
    setLoading(true);
    const selected = menuList[Math.floor(Math.random() * menuList.length)];
    setItems(selected);
    console.log("setItem finished")
    const selectedLink = "https://map.naver.com/v5/search/" + selected;
    setLinks(selectedLink);
    console.log("setLink finished")
    const selectedImg = "/imgs/" + translator(selected) + ".jpg"
    setImgs(selectedImg);
    console.log("setImgs finished")
    // setTimeout(setLoading(false), 300);
    setLoading(false);
  }

  const clickHandlerKakao = () => {
    if (typeof window != 'undefined') {
      // const title = items;
      // const sharelink = links;
      shareKakao(items, links);
    }
  }
  // console.log("imgs,", links);
  return (
    <div className={styles.container}>
      <Head>
        <title>ì˜¤ëŠ˜ ì ì‹¬ ë­ë¨¹ì§€?</title>
        {/* <meta name="description" content="Generated by create next app" /> */}
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <h1 className={styles.title}>
          ì˜¤ëŠ˜ ì ì‹¬ì€ ë­ ë¨¹ì§€?
        </h1>

        {/* <NoSSRComponent /> */}
        {/* {!isServer() ? <AnimationButton></AnimationButton> : 'null'} */}

        <div onClick={clickHandler} className={styles.item}>
            {/* {loading? <Loading></Loading>: {items}} */}
            {items}
        </div>

        <div className={styles.bgWrap}>
          <Image 
            src={imgs}
            alt={items}
            layout="fill"
            objectFit="cover"
            // quality={25}
            priority
          ></Image>
        </div>

        <div className={styles.grid}>
          <a onClick={clickHandler} className={styles.card}>
            <h2>ğŸ”„ ë‹¤ì‹œ ëŒë¦¬ê¸°</h2>
          </a>

          <a href={links} target="_blank" className={styles.card} rel="noreferrer">
            <h2>ğŸ” ê²€ìƒ‰í•˜ê¸°</h2>
          </a>
          <a onClick={clickHandlerKakao} className={styles.card}>
            <h2>ğŸ’¬ ê³µìœ í•˜ê¸°</h2>
          </a>
        </div>
      </main>

      {/* <footer className={styles.footer}>
        <a
          href="https://vercel.com?utm_source=create-next-app&utm_medium=default-template&utm_campaign=create-next-app"
          target="_blank"
          rel="noopener noreferrer"
        >
          Powered by{' '}
          <span className={styles.logo}>
            <Image src="/vercel.svg" alt="Vercel Logo" width={72} height={16} />
          </span>
        </a>
      </footer> */}
    </div>
  );
}

